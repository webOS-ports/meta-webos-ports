From 7a98d39046289158e31f4e56ee7c52529540c589 Mon Sep 17 00:00:00 2001
From: Martin Jansa <Martin.Jansa@gmail.com>
Date: Tue, 1 Aug 2023 19:11:02 +0200
Subject: [PATCH] PinePhone: update from meta-webos-ports

* as it was in:
  https://github.com/webOS-ports/meta-webos-ports/commit/61143a41d8156449dba3a7dabd28b56446b2b07c

Signed-off-by: Martin Jansa <Martin.Jansa@gmail.com>
---
Upstream-Status: Pending

 ucm2/Allwinner/A64/PinePhone/HiFi.conf      | 78 ++++++++++++++------
 ucm2/Allwinner/A64/PinePhone/PinePhone.conf | 52 --------------
 ucm2/Allwinner/A64/PinePhone/VoiceCall.conf | 80 +++++++++++++++------
 3 files changed, 113 insertions(+), 97 deletions(-)

diff --git a/ucm2/Allwinner/A64/PinePhone/HiFi.conf b/ucm2/Allwinner/A64/PinePhone/HiFi.conf
index 00779ae..53e61d5 100644
--- a/ucm2/Allwinner/A64/PinePhone/HiFi.conf
+++ b/ucm2/Allwinner/A64/PinePhone/HiFi.conf
@@ -1,14 +1,55 @@
 SectionVerb {
 	EnableSequence [
+		cset "name='Headphone Playback Switch' off"
+		cset "name='Headphone Source Playback Route' DAC"
+		cset "name='Line In Playback Switch' off"
+		cset "name='Line Out Playback Switch' off"
+		cset "name='Line Out Source Playback Route' Mono Differential"
+		cset "name='Mic1 Playback Switch' off"
+		cset "name='Mic2 Playback Switch' off"
+		cset "name='AIF1 DA0 Playback Volume' 160"
+		cset "name='AIF3 ADC Source Capture Route' None"
+		cset "name='AIF2 DAC Source Playback Route' None"
+		cset "name='DAC Playback Switch' on"
+		cset "name='DAC Playback Volume' 160"
+		cset "name='ADC Digital DAC Playback Switch' off"
+		cset "name='AIF1 Slot 0 Digital DAC Playback Switch' on"
 		cset "name='AIF2 Digital DAC Playback Switch' off"
+		cset "name='DAC Reversed Playback Switch' off"
+		cset "name='Earpiece Playback Switch' off"
+		cset "name='Earpiece Source Playback Route' DACL"
+
+		cset "name='Line In Capture Switch' off"
+		cset "name='Mic1 Capture Switch' off"
+		cset "name='Mic1 Boost Volume' 7"
+		cset "name='Mic2 Capture Switch' off"
+		cset "name='Mic2 Boost Volume' 7"
+		cset "name='Mixer Capture Switch' off"
+		cset "name='Mixer Reversed Capture Switch' off"
+		cset "name='ADC Capture Volume' 160"
+		cset "name='ADC Gain Capture Volume' 7"
+		cset "name='AIF1 AD0 Capture Volume' 160"
+		cset "name='AIF1 Data Digital ADC Capture Switch' on"
 		cset "name='AIF2 ADC Mixer ADC Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF1 DA0 Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF2 DAC Rev Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF1 DA0 Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF1 DA0 Capture Switch' off"
 	]
+
+        DisableSequence [
+        ]
+
+	Value {
+	}
 }
 
 SectionDevice."Speaker" {
 	Comment "Internal speaker"
 	EnableSequence [
+		cset "name='AIF1 DA0 Stereo Playback Route' Mix Mono"
 		cset "name='Line Out Playback Switch' on"
+		cset "name='Line Out Playback Volume' 100%"
 	]
 
 	DisableSequence [
@@ -16,17 +57,18 @@ SectionDevice."Speaker" {
 	]
 
 	Value {
-		PlaybackMixerElem "Line Out"
+		PlaybackVolume "Line Out Playback Volume"
+		PlaybackSwitch "Line Out Playback Switch"
+		PlaybackChannels 2
 		PlaybackPriority 300
 		PlaybackPCM "hw:${CardId},0"
 	}
 }
-
 SectionDevice."Earpiece" {
 	Comment "Internal Earpiece"
-
 	EnableSequence [
 		cset "name='Earpiece Playback Switch' on"
+		cset "name='Earpiece Playback Volume' 100%"
 	]
 
 	DisableSequence [
@@ -34,64 +76,54 @@ SectionDevice."Earpiece" {
 	]
 
 	Value {
-		PlaybackMixerElem "Earpiece"
+		PlaybackVolume "Earpiece Playback Volume"
+		PlaybackSwitch "Earpiece Playback Switch"
+		PlaybackChannels 2
 		PlaybackPriority 200
 		PlaybackPCM "hw:${CardId},0"
 	}
 }
-
 SectionDevice."Mic" {
 	Comment "Internal Microphone"
-
 	ConflictingDevice [
 		"Headset"
 	]
-
 	EnableSequence [
 		cset "name='Mic1 Capture Switch' on"
 	]
-
 	DisableSequence [
 		cset "name='Mic1 Capture Switch' off"
 	]
-
 	Value {
 		CapturePriority 100
 		CapturePCM "hw:${CardId},0"
-		CaptureVolume "ADC Capture Volume"
-		CaptureSwitch "Mic1 Capture Switch"
+		CaptureChannels 2
 	}
 }
-
 SectionDevice."Headset" {
 	Comment "Headset Microphone"
-
 	ConflictingDevice [
 		"Mic"
 	]
-
 	EnableSequence [
 		cset "name='Mic2 Capture Switch' on"
 	]
-
 	DisableSequence [
 		cset "name='Mic2 Capture Switch' off"
 	]
-
 	Value {
 		CapturePriority 500
 		CapturePCM "hw:${CardId},0"
-		CaptureVolume "ADC Capture Volume"
-		CaptureSwitch "Mic2 Capture Switch"
+		CaptureChannels 2
 		JackControl "Headset Microphone Jack"
 	}
 }
-
 SectionDevice."Headphones" {
-	Comment "Headphones"
-
+	Comment "Headset"
 	EnableSequence [
+		cset "name='AIF1 DA0 Stereo Playback Route' Stereo"
 		cset "name='Headphone Playback Switch' on"
+		cset "name='Headphone Playback Volume' 70%"
 	]
 
 	DisableSequence [
@@ -99,7 +131,9 @@ SectionDevice."Headphones" {
 	]
 
 	Value {
-		PlaybackMixerElem "Headphone"
+		PlaybackVolume "Headphone Playback Volume"
+		PlaybackSwitch "Headphone Playback Switch"
+		PlaybackChannels 2
 		PlaybackPriority 500
 		PlaybackPCM "hw:${CardId},0"
 		JackControl "Headphone Jack"
diff --git a/ucm2/Allwinner/A64/PinePhone/PinePhone.conf b/ucm2/Allwinner/A64/PinePhone/PinePhone.conf
index cdb18be..f1a9fdc 100644
--- a/ucm2/Allwinner/A64/PinePhone/PinePhone.conf
+++ b/ucm2/Allwinner/A64/PinePhone/PinePhone.conf
@@ -13,55 +13,3 @@ SectionUseCase."Voice Call" {
 	File "/Allwinner/A64/PinePhone/VoiceCall.conf"
 	Comment "Make a phone call"
 }
-
-FixedBootSequence [
-	# Routing.
-	cset "name='ADC Digital DAC Playback Switch' off"
-	cset "name='AIF1 DA0 Stereo Playback Route' Stereo"
-	cset "name='AIF1 Data Digital ADC Capture Switch' on"
-	cset "name='AIF1 Slot 0 Digital DAC Playback Switch' on"
-	cset "name='AIF2 DAC Source Playback Route' AIF2"
-	# AIF2 (Modem) is mono.
-	cset "name='AIF2 DAC Stereo Playback Route' Mix Mono"
-	cset "name='AIF3 ADC Source Capture Route' None"
-	cset "name='DAC Playback Switch' on"
-	# Routes DACR->MIXL and DACL->MIXR => MIXL are MIXR are identical mono-mix of the DAC.
-	cset "name='DAC Reversed Playback Switch' on"
-	cset "name='Earpiece Source Playback Route' Left Mixer"
-	cset "name='Headphone Source Playback Route' DAC"
-	# The Pinephone speaker is mono.
-	cset "name='Line Out Source Playback Route' Mono Differential"
-]
-
-BootSequence [
-	# Playback volumes.
-	cset "name='AIF1 DA0 Playback Volume' 160"
-	cset "name='AIF2 DAC Playback Volume' 160"
-	cset "name='DAC Playback Volume' 160"
-	cset "name='Earpiece Playback Volume' 100%"
-	cset "name='Headphone Playback Volume' 70%"
-	cset "name='Line Out Playback Volume' 100%"
-	cset "name='Mic2 Boost Volume' 1"
-
-	# Capture volumes.
-	cset "name='ADC Capture Volume' 160"
-	cset "name='AIF1 AD0 Capture Volume' 160"
-	cset "name='AIF2 ADC Capture Volume' 160"
-]
-
-SectionDefaults [
-	# Switch playback off.
-	cset "name='Earpiece Playback Switch' off"
-	cset "name='Headphone Playback Switch' off"
-	cset "name='Line In Playback Switch' off"
-	cset "name='Line Out Playback Switch' off"
-	cset "name='Mic1 Playback Switch' off"
-	cset "name='Mic2 Playback Switch' off"
-
-	# Switch capture off.
-	cset "name='Line In Capture Switch' off"
-	cset "name='Mic1 Capture Switch' off"
-	cset "name='Mic2 Capture Switch' off"
-	cset "name='Mixer Capture Switch' off"
-	cset "name='Mixer Reversed Capture Switch' off"
-]
\ No newline at end of file
diff --git a/ucm2/Allwinner/A64/PinePhone/VoiceCall.conf b/ucm2/Allwinner/A64/PinePhone/VoiceCall.conf
index fb3cb58..62e0155 100644
--- a/ucm2/Allwinner/A64/PinePhone/VoiceCall.conf
+++ b/ucm2/Allwinner/A64/PinePhone/VoiceCall.conf
@@ -1,9 +1,49 @@
 SectionVerb {
 	EnableSequence [
+		cset "name='Headphone Playback Switch' off"
+		cset "name='Headphone Source Playback Route' DAC"
+		cset "name='Line In Playback Switch' off"
+		cset "name='Line Out Playback Switch' off"
+		cset "name='Line Out Source Playback Route' Mono Differential"
+		cset "name='Mic1 Playback Switch' off"
+		cset "name='Mic2 Playback Switch' off"
+		cset "name='AIF1 DA0 Playback Volume' 160"
+		cset "name='AIF2 DAC Playback Volume' 160"
+		cset "name='AIF3 ADC Source Capture Route' None"
+		cset "name='AIF2 DAC Source Playback Route' None"
+		cset "name='DAC Playback Switch' on"
+		cset "name='DAC Playback Volume' 160"
+		cset "name='ADC Digital DAC Playback Switch' off"
+		cset "name='AIF1 Slot 0 Digital DAC Playback Switch' on"
 		cset "name='AIF2 Digital DAC Playback Switch' on"
+		cset "name='DAC Reversed Playback Switch' off"
+		cset "name='Earpiece Playback Switch' off"
+		cset "name='Earpiece Source Playback Route' DACL"
+
+		cset "name='Line In Capture Switch' off"
+		cset "name='Mic1 Capture Switch' off"
+		cset "name='Mic1 Boost Volume' 0"
+		cset "name='Mic1 Playback Volume' 7"
+		cset "name='Mic2 Capture Switch' off"
+		cset "name='Mic2 Boost Volume' 0"
+		cset "name='Mic2 Playback Volume' 7"
+		cset "name='Mixer Capture Switch' off"
+		cset "name='Mixer Reversed Capture Switch' off"
+		cset "name='ADC Capture Volume' 160"
+		cset "name='ADC Gain Capture Volume' 7"
+		cset "name='AIF1 AD0 Capture Volume' 160"
+		cset "name='AIF1 Data Digital ADC Capture Switch' on"
+		cset "name='AIF2 ADC Capture Volume' 160"
 		cset "name='AIF2 ADC Mixer ADC Capture Switch' on"
+		cset "name='AIF2 ADC Mixer AIF1 DA0 Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF2 DAC Rev Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF1 DA0 Capture Switch' off"
+		cset "name='AIF2 ADC Mixer AIF1 DA0 Capture Switch' off"
 	]
 
+        DisableSequence [
+        ]
+
 	Value {
 		PlaybackRate 8000
 	}
@@ -11,9 +51,10 @@ SectionVerb {
 
 SectionDevice."Speaker" {
 	Comment "Internal speaker"
-
 	EnableSequence [
+		cset "name='AIF1 DA0 Stereo Playback Route' Mix Mono"
 		cset "name='Line Out Playback Switch' on"
+		cset "name='Line Out Playback Volume' 100%"
 	]
 
 	DisableSequence [
@@ -21,17 +62,18 @@ SectionDevice."Speaker" {
 	]
 
 	Value {
-		PlaybackMixerElem "Line Out"
+		PlaybackVolume "Line Out Playback Volume"
+		PlaybackSwitch "Line Out Playback Switch"
+		PlaybackChannels 2
 		PlaybackPriority 300
 		PlaybackPCM "hw:${CardId},0"
 	}
 }
-
 SectionDevice."Earpiece" {
 	Comment "Internal Earpiece"
-
 	EnableSequence [
 		cset "name='Earpiece Playback Switch' on"
+		cset "name='Earpiece Playback Volume' 100%"
 	]
 
 	DisableSequence [
@@ -39,64 +81,54 @@ SectionDevice."Earpiece" {
 	]
 
 	Value {
-		PlaybackMixerElem "Earpiece"
+		PlaybackVolume "Earpiece Playback Volume"
+		PlaybackSwitch "Earpiece Playback Switch"
+		PlaybackChannels 2
 		PlaybackPriority 500
 		PlaybackPCM "hw:${CardId},0"
 	}
 }
-
 SectionDevice."Mic" {
 	Comment "Internal Microphone"
-
 	ConflictingDevice [
 		"Headset"
 	]
-
 	EnableSequence [
 		cset "name='Mic1 Capture Switch' on"
 	]
-
 	DisableSequence [
 		cset "name='Mic1 Capture Switch' off"
 	]
-
 	Value {
 		CapturePriority 200
 		CapturePCM "hw:${CardId},0"
-		CaptureVolume "ADC Capture Volume"
-		CaptureSwitch "Mic1 Capture Switch"
+		CaptureChannels 2
 	}
 }
-
 SectionDevice."Headset" {
 	Comment "Headset Microphone"
-
 	ConflictingDevice [
 		"Mic"
 	]
-
 	EnableSequence [
 		cset "name='Mic2 Capture Switch' on"
 	]
-
 	DisableSequence [
 		cset "name='Mic2 Capture Switch' off"
 	]
-
 	Value {
 		CapturePriority 500
 		CapturePCM "hw:${CardId},0"
-		CaptureVolume "ADC Capture Volume"
-		CaptureSwitch "Mic2 Capture Switch"
+		CaptureChannels 2
 		JackControl "Headset Microphone Jack"
 	}
 }
-
 SectionDevice."Headphones" {
-	Comment "Headphones"
-
+	Comment "Headset"
 	EnableSequence [
+		cset "name='AIF1 DA0 Stereo Playback Route' Stereo"
 		cset "name='Headphone Playback Switch' on"
+		cset "name='Headphone Playback Volume' 100%"
 	]
 
 	DisableSequence [
@@ -104,7 +136,9 @@ SectionDevice."Headphones" {
 	]
 
 	Value {
-		PlaybackMixerElem "Headphone"
+		PlaybackVolume "Headphone Playback Volume"
+		PlaybackSwitch "Headphone Playback Switch"
+		PlaybackChannels 2
 		PlaybackPriority 500
 		PlaybackPCM "hw:${CardId},0"
 		JackControl "Headphone Jack"

From 840bdc8ddd936954bb3804df1c5fbbf1d820b93f Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Sat, 5 May 2018 13:41:35 +0000
Subject: [PATCH] Fix build with Wayland SDL2

Signed-off-by: Christophe Chapuis <chris.chapuis@gmail.com>
---
 external/android-emugl/host/libs/Translator/GLcommon/GLDispatch.cpp | 2 +-
 src/anbox/platform/sdl/window.cpp                                   | 6 +++---
 src/anbox/ui/splash_screen.cpp                                      | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/external/android-emugl/host/libs/Translator/GLcommon/GLDispatch.cpp b/external/android-emugl/host/libs/Translator/GLcommon/GLDispatch.cpp
index ff491a5..46e4238 100644
--- a/external/android-emugl/host/libs/Translator/GLcommon/GLDispatch.cpp
+++ b/external/android-emugl/host/libs/Translator/GLcommon/GLDispatch.cpp
@@ -23,7 +23,7 @@
 #include "OpenglCodecCommon/ErrorLog.h"
 
 #ifdef __linux__
-#include <GL/glx.h>
+#include <GL/gl.h>
 #elif defined(WIN32)
 #include <windows.h>
 #endif
diff --git a/src/anbox/platform/sdl/window.cpp b/src/anbox/platform/sdl/window.cpp
index c129d2b..45ef5e4 100644
--- a/src/anbox/platform/sdl/window.cpp
+++ b/src/anbox/platform/sdl/window.cpp
@@ -67,9 +67,9 @@ Window::Window(const std::shared_ptr<Renderer> &renderer,
   SDL_VERSION(&info.version);
   SDL_GetWindowWMInfo(window_, &info);
   switch (info.subsystem) {
-    case SDL_SYSWM_X11:
-      native_display_ = static_cast<EGLNativeDisplayType>(info.info.x11.display);
-      native_window_ = static_cast<EGLNativeWindowType>(info.info.x11.window);
+    case SDL_SYSWM_WAYLAND:
+      native_display_ = static_cast<EGLNativeDisplayType>(info.info.wl.display);
+      native_window_ = (EGLNativeWindowType)(info.info.wl.shell_surface);
       break;
 #if defined(MIR_SUPPORT)
     case SDL_SYSWM_MIR: {
diff --git a/src/anbox/ui/splash_screen.cpp b/src/anbox/ui/splash_screen.cpp
index 01ed648..8e3549f 100644
--- a/src/anbox/ui/splash_screen.cpp
+++ b/src/anbox/ui/splash_screen.cpp
@@ -20,7 +20,7 @@
 #include "anbox/utils.h"
 #include "anbox/logger.h"
 
-#include <SDL2/SDL_image.h>
+#include <SDL_image.h>
 
 namespace anbox {
 namespace ui {
-- 
2.7.4


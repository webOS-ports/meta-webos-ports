From 45ff154423fa639208c80a653e6698c22611a60d Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Thu, 3 Aug 2023 18:55:32 +0000
Subject: [PATCH] Fix Qt6 compatibility

Upstream-Status: Pending [for 2nd chunk and Inappropriate for 1st chunk see https://github.com/jmlich/sensorfw/pull/1]

---
 core/core.pro   | 2 +-
 core/loader.cpp | 4 ++++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/core/core.pro b/core/core.pro
index 5239e36..64a1907 100644
--- a/core/core.pro
+++ b/core/core.pro
@@ -15,7 +15,7 @@ SENSORFW_INCLUDEPATHS = .. \
 DEPENDPATH += $$SENSORFW_INCLUDEPATHS
 INCLUDEPATH += $$SENSORFW_INCLUDEPATHS
 
-DEFINES += PLUGIN_DIRECTORY=\"\\\"$$[QT_INSTALL_LIBS]/sensord-qt$${QT_MAJOR_VERSION}\\\"\"
+DEFINES += PLUGIN_DIRECTORY=\"\\\"$${QT6_INSTALL_LIBDIR}/sensord-qt$${QT_MAJOR_VERSION}\\\"\"
 
 QMAKE_LIBDIR_FLAGS += -L../datatypes\
                       -lsensordatatypes-qt$${QT_MAJOR_VERSION}
diff --git a/core/loader.cpp b/core/loader.cpp
index aae6055..e8b2e1b 100644
--- a/core/loader.cpp
+++ b/core/loader.cpp
@@ -55,7 +55,11 @@ Loader& Loader::instance()
 
 #define PLUGIN_PREFIX_ENV "SENSORFW_LIBRARY_PATH"
 #define PLUGIN_PREFIX     "lib"
+#if QT_VERSION >= QT_VERSION_CHECK(6, 0, 0)
+#define PLUGIN_SUFFIX     "-qt6.so"
+#else
 #define PLUGIN_SUFFIX     "-qt5.so"
+#endif
 #define SENSOR_SUFFIX     "sensor"
 
 static QString getPluginDirectory()
-- 
2.34.1


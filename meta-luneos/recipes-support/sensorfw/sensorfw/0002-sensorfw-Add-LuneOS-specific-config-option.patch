From 08187d7ab67a7950b8226efc9049527f7f9ddcd3 Mon Sep 17 00:00:00 2001
From: Herrie <Github.com@herrie.org>
Date: Tue, 14 Nov 2023 09:46:07 +0100
Subject: [PATCH] sensorfw: Add LuneOS specific config option

Trying to fix sensors with Qt6 on LuneOS.

Signed-off-by: Herman van Hazendonk <github.com@herrie.org>
---
Upstream-Status: Pending

 common-config.pri | 2 +-
 core/hybris.pro   | 2 +-
 sensorfw.pro      | 5 ++++-
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/common-config.pri b/common-config.pri
index 1ac908b..2cbf2fb 100644
--- a/common-config.pri
+++ b/common-config.pri
@@ -34,7 +34,7 @@ TARGET = $$TARGET-qt$${QT_MAJOR_VERSION}
 OTHER_FILES += \
     ../../common.pri
 
-contains(CONFIG,hybris) {
+contains(CONFIG,hybris)|contains(CONFIG,luneos) {
     CONFIG += link_pkgconfig
     contains(CONFIG,binder) {
         DEFINES += USE_BINDER=1
diff --git a/core/hybris.pro b/core/hybris.pro
index a9c87dc..e2298d7 100644
--- a/core/hybris.pro
+++ b/core/hybris.pro
@@ -19,7 +19,7 @@ LIBS += -L$$[QT_INSTALL_LIBS] -L../datatypes -lsensordatatypes-qt$${QT_MAJOR_VER
 
 CONFIG += link_pkgconfig
 
-!contains(CONFIG,binder) {
+!contains(CONFIG,binder)&!contains(CONFIG,luneos) {
     LIBS += -lhybris-common
     PKGCONFIG += android-headers libhardware
 }
diff --git a/sensorfw.pro b/sensorfw.pro
index d476fa3..b56d9ee 100644
--- a/sensorfw.pro
+++ b/sensorfw.pro
@@ -7,8 +7,11 @@
 #   qmake CONFIG+=autohybris
 # And pro-file behavioral differences are handled via:
 #   config_hybris { ... }
+#
+# LuneOS builds: Uses build time hybris check:
+#   qmake CONFIG+=autohybris luneos
 
-contains(CONFIG,autohybris) {
+contains(CONFIG,autohybris)|contains(CONFIG,luneos) {
     load(configure)
     qtCompileTest(hybris)
 }

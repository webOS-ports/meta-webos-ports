From d248c2e6fb8ebece070c4534437923da90432be6 Mon Sep 17 00:00:00 2001
From: Takuto Ikuta <tikuta@chromium.org>
Date: Tue, 18 May 2021 12:42:42 +0000
Subject: [PATCH] protobuf: use python3 for protoc_wrapper.py

Fixed: 1205614
Change-Id: I9e8a1ea1691f90bd71fb8ee83e36dcd1fe767f67
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/2902951
Auto-Submit: Takuto Ikuta <tikuta@chromium.org>
Commit-Queue: Nico Weber <thakis@chromium.org>
Reviewed-by: Nico Weber <thakis@chromium.org>
Cr-Commit-Position: refs/heads/master@{#883915}
---
 src/third_party/protobuf/proto_library.gni | 13 ++-----------
 src/tools/protoc_wrapper/protoc_wrapper.py |  2 +-
 2 files changed, 3 insertions(+), 12 deletions(-)

diff --git a/src/third_party/protobuf/proto_library.gni b/src/third_party/protobuf/proto_library.gni
index bf0b1433aa..a6943f5896 100644
--- a/src/third_party/protobuf/proto_library.gni
+++ b/src/third_party/protobuf/proto_library.gni
@@ -314,17 +314,8 @@ template("proto_library") {
       ":$javascript_name",
       ":$source_set_name",
     ]
-    if ((defined(invoker.run_under_python2) && invoker.run_under_python2) ||
-        true) {
-      # TODO(crbug.com/1112471) - get all users of this to run cleanly under
-      # Python 3 and then remove this option.
-      script = "//build/util/python2_action.py"
-      args = [ rebase_path("//tools/protoc_wrapper/protoc_wrapper.py",
-                           root_build_dir) ] + protos
-    } else {
-      script = "//tools/protoc_wrapper/protoc_wrapper.py"
-      args = protos
-    }
+    script = "//tools/protoc_wrapper/protoc_wrapper.py"
+    args = protos
 
     sources = proto_sources
     outputs = get_path_info(protogens + protogens_cc + protogens_js, "abspath")
diff --git a/src/tools/protoc_wrapper/protoc_wrapper.py b/src/tools/protoc_wrapper/protoc_wrapper.py
index 5afc7754c0..dc8a3f1ccd 100755
--- a/src/tools/protoc_wrapper/protoc_wrapper.py
+++ b/src/tools/protoc_wrapper/protoc_wrapper.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Copyright (c) 2012 The Chromium Authors. All rights reserved.
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.

From 05d76e4e0547f68029f34e8145fca1eb241dd04b Mon Sep 17 00:00:00 2001
From: Takuto Ikuta <tikuta@chromium.org>
Date: Wed, 19 May 2021 11:29:16 +0000
Subject: [PATCH] components: run gen_file_type_proto.py in python3

Fixed: 1205602
Change-Id: I8566c08e74ac34e1c365bf8607d0eb1a1b7d6935
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/2905118
Auto-Submit: Takuto Ikuta <tikuta@chromium.org>
Commit-Queue: Nico Weber <thakis@chromium.org>
Reviewed-by: Nico Weber <thakis@chromium.org>
Cr-Commit-Position: refs/heads/master@{#884391}
Signed-off-by: Martin Jansa <martin.jansa@lge.com>
---
 src/components/safe_browsing/core/resources/BUILD.gn   |  7 ++-----
 .../core/resources/gen_file_type_proto.py              | 10 ++++++----
 2 files changed, 8 insertions(+), 9 deletions(-)

diff --git a/src/components/safe_browsing/core/resources/BUILD.gn b/src/components/safe_browsing/core/resources/BUILD.gn
index c0b0acc2d5..21d9cee887 100644
--- a/src/components/safe_browsing/core/resources/BUILD.gn
+++ b/src/components/safe_browsing/core/resources/BUILD.gn
@@ -3,13 +3,11 @@
 # found in the LICENSE file.
 
 import("//build/config/chromeos/ui_mode.gni")
-import("//build/config/python.gni")
 
 # TODO(nparker): reduce the duplication between these two, somehow.
 
 # Generate the binary proto form of "file_types" from the ascii proto.
-# TODO(crbug.com/1112471): Get this to run cleanly under Python 3.
-python2_action("make_file_types_protobuf") {
+action("make_file_types_protobuf") {
   script = "gen_file_type_proto.py"
 
   # The output goes in $target_gen_dir since that's where
@@ -67,8 +65,7 @@ python2_action("make_file_types_protobuf") {
 
 # Generate the binary proto for ALL platforms.  This is only run manually
 # when pushing the files to GCS for the component-updater to pick up.
-# TODO(crbug.com/1112471): Get this to run cleanly under Python 3.
-python2_action("make_all_file_types_protobuf") {
+action("make_all_file_types_protobuf") {
   script = "gen_file_type_proto.py"
 
   input_filename = "download_file_types.asciipb"
diff --git a/src/components/safe_browsing/core/resources/gen_file_type_proto.py b/src/components/safe_browsing/core/resources/gen_file_type_proto.py
index 3974ba3dbd..c2b3daa44d 100755
--- a/src/components/safe_browsing/core/resources/gen_file_type_proto.py
+++ b/src/components/safe_browsing/core/resources/gen_file_type_proto.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python3
 # Copyright 2016 The Chromium Authors. All rights reserved.
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
@@ -10,6 +10,8 @@
  each which contains only the values that platform needs.
 """
 
+from __future__ import absolute_import
+from __future__ import print_function
 import os
 import re
 import sys
@@ -154,7 +156,7 @@ class DownloadFileTypeProtoGenerator(BinaryProtoGenerator):
       FilterForPlatformAndWrite(pb, platform_enum, outfile)
     else:
       # Make a separate file for each platform
-      for platform_type, platform_enum in PlatformTypes().iteritems():
+      for platform_type, platform_enum in PlatformTypes().items():
         # e.g. .../all/77/chromeos/download_file_types.pb
         outfile = os.path.join(opts.outdir,
                                str(pb.version_id),
@@ -179,12 +181,12 @@ class DownloadFileTypeProtoGenerator(BinaryProtoGenerator):
 
   def VerifyArgs(self, opts):
     if (not opts.all and opts.type not in PlatformTypes()):
-      print "ERROR: Unknown platform type '%s'" % opts.type
+      print("ERROR: Unknown platform type '%s'" % opts.type)
       self.opt_parser.print_help()
       return False
 
     if (bool(opts.all) == bool(opts.type)):
-      print "ERROR: Need exactly one of --type or --all"
+      print("ERROR: Need exactly one of --type or --all")
       self.opt_parser.print_help()
       return False
     return True

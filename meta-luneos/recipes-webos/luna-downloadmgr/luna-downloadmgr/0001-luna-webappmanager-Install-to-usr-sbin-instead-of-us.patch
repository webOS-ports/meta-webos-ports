From 43f6ccb43ed3fd2e96e3972e3de1b02ef90c2176 Mon Sep 17 00:00:00 2001
From: Herman van Hazendonk <github.com@herrie.org>
Date: Wed, 26 Jan 2022 09:00:22 +0100
Subject: [PATCH 1/6] luna-webappmanager: Install to /usr/sbin instead of
 /usr/bin

To be consistent with other components.

Signed-off-by: Herman van Hazendonk <github.com@herrie.org>
---
 CMakeLists.txt                                |  7 ++++---
 files/launch/luna-downloadmgr.sh              | 21 +++++++++++++++++++
 ...webos.service.downloadmanager.role.json.in |  2 +-
 ...m.webos.service.downloadmanager.service.in |  2 +-
 4 files changed, 27 insertions(+), 5 deletions(-)
 create mode 100644 files/launch/luna-downloadmgr.sh

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 0d0a9ba..69de506 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -110,7 +110,7 @@ target_link_libraries(${CMAKE_PROJECT_NAME}
 #                    webos_build_daemon, RESTRICTED_PERMISSIONS give
 #                    WORLD_READ WORLD_EXECUTE extra bits)
 install(TARGETS ${CMAKE_PROJECT_NAME}
-        DESTINATION ${WEBOS_INSTALL_BINDIR}
+        DESTINATION ${WEBOS_INSTALL_SBINDIR}
         PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE
                     GROUP_READ GROUP_EXECUTE)
 
@@ -131,8 +131,9 @@ webos_build_system_bus_files()
 # these two lines can be deleted
 webos_build_configured_file(files/launch/LunaDownloadMgr SYSCONFDIR event.d)
 webos_build_configured_file(files/launch/LunaDownloadMgr.conf SYSCONFDIR init)
-webos_build_configured_file(files/launch/luna-download-mgr.service SYSCONFDIR systemd/system)
-webos_build_configured_file(files/launch/luna-download-mgr.sh SYSCONFDIR systemd/system/scripts)
+webos_build_configured_file(files/launch/luna-downloadmgr.service SYSCONFDIR systemd/system)
+
+install(PROGRAMS files/launch/luna-downloadmgr.sh DESTINATION /etc/systemd/system/scripts)
 
 file(GLOB_RECURSE SCHEMAS files/schema/*.schema)
 install(FILES ${SCHEMAS} DESTINATION ${WEBOS_INSTALL_WEBOS_SYSCONFDIR}/schemas/luna-downloadmgr)
diff --git a/files/launch/luna-downloadmgr.sh b/files/launch/luna-downloadmgr.sh
new file mode 100644
index 0000000..0dc27a3
--- /dev/null
+++ b/files/launch/luna-downloadmgr.sh
@@ -0,0 +1,21 @@
+#!/bin/sh
+# Copyright (c) 2019 LG Electronics, Inc.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+# SPDX-License-Identifier: Apache-2.0
+
+if [ -d /dev/cgroup ] ; then
+    mkdir -p /dev/cgroup/web
+    echo $$ > /dev/cgroup/web/tasks
+fi
diff --git a/files/sysbus/com.webos.service.downloadmanager.role.json.in b/files/sysbus/com.webos.service.downloadmanager.role.json.in
index dd36767..4cb50ad 100644
--- a/files/sysbus/com.webos.service.downloadmanager.role.json.in
+++ b/files/sysbus/com.webos.service.downloadmanager.role.json.in
@@ -1,5 +1,5 @@
 {
-    "exeName":"@WEBOS_INSTALL_BINDIR@/LunaDownloadMgr",
+    "exeName":"@WEBOS_INSTALL_SBINDIR@/LunaDownloadMgr",
     "type": "regular",
     "trustLevel" : "oem",
     "allowedNames": ["com.webos.service.downloadmanager"],
diff --git a/files/sysbus/com.webos.service.downloadmanager.service.in b/files/sysbus/com.webos.service.downloadmanager.service.in
index ee23c62..0cab0ca 100644
--- a/files/sysbus/com.webos.service.downloadmanager.service.in
+++ b/files/sysbus/com.webos.service.downloadmanager.service.in
@@ -1,4 +1,4 @@
 [D-BUS Service]
 Name=com.webos.service.downloadmanager
-Exec=@WEBOS_INSTALL_BINDIR@/LunaDownloadMgr
+Exec=@WEBOS_INSTALL_SBINDIR@/LunaDownloadMgr
 Type=${${CMAKE_PROJECT_NAME}_SERVICE_TYPE}
-- 
2.37.3.windows.1


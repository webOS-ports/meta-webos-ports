From 5588ab78ffa697191caa8fbc8f16d966c94f45da Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Sun, 3 Apr 2022 10:11:39 +0000
Subject: [PATCH 1/2] Add relaunch support for legacy enyo apps

Signed-off-by: Christophe Chapuis <chris.chapuis@gmail.com>
---
 src/core/web_page_base.cc | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/core/web_page_base.cc b/src/core/web_page_base.cc
index d5ea1aa..ab1d877 100644
--- a/src/core/web_page_base.cc
+++ b/src/core/web_page_base.cc
@@ -271,6 +271,12 @@ void WebPageBase::SendRelaunchEvent() {
       << "    var launchEvent=new CustomEvent('webOSRelaunch', { detail: "
       << detail << " });"
       << "    document.dispatchEvent(launchEvent);"
+      
+      << "    console.log('[WAM] call Mojo.relaunch() for legacy apps');"
+      << "    if(typeof Mojo !== 'undefined') {"
+      << "      PalmSystem.launchParams = JSON.stringify(" << detail << ");"
+      << "      Mojo.relaunch();"
+      << "    }"
       << "}, 1);";
   EvaluateJavaScript(relaunchEvent.str().c_str());
 }
-- 
2.17.1


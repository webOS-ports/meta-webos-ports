From d8cc2292fc18299620086a8a54b59ee66bb0ccf9 Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Thu, 21 Jun 2018 17:12:19 +0000
Subject: [PATCH] Temporary fix for SIGBUS crash: disable TLS

A conflict occurs between Qt threads and bionic threads; as a
temporary fix, disable TLS in Qt to avoid such conflict.

Signed-off-by: Christophe Chapuis <chris.chapuis@gmail.com>
---
 src/corelib/thread/qthread_unix.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/corelib/thread/qthread_unix.cpp b/src/corelib/thread/qthread_unix.cpp
index 9ad32b162d..2a5eb26e9f 100644
--- a/src/corelib/thread/qthread_unix.cpp
+++ b/src/corelib/thread/qthread_unix.cpp
@@ -111,7 +111,7 @@ enum { ThreadPriorityResetFlag = 0x80000000 };
 
 #if defined(Q_OS_LINUX) && defined(__GLIBC__) && (defined(Q_CC_GNU) || defined(Q_CC_INTEL)) && !defined(QT_LINUXBASE)
 /* LSB doesn't have __thread, https://lsbbugs.linuxfoundation.org/show_bug.cgi?id=993 */
-#define HAVE_TLS
+#undef HAVE_TLS
 #endif
 #if defined(Q_CC_XLC) || defined (Q_CC_SUN)
 #define HAVE_TLS
